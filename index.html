<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="style.css" />
    <title>親のHTML</title>
    <meta name="description" content="親のHTMLです" />
  </head>

  <body>
    <h1>モーダルでiframeを開く</h1>
    <div id="app"></div>
  </body>
  <script>
    // parent
    const app = document.getElementById("app");
    // overlay
    const div = document.createElement("div");
    app.appendChild(div);

    const iframe = document.createElement("iframe");
    const iframeAttr = {
      id: "my-iframe",
      src: "modal.html",
      class: "frame_center",
      height: "600px",
      width: "500px",
      frameborder: "0",
      scrolling: "no",
    };
    setAttr(iframe, iframeAttr);

    // button
    const openButton = document.createElement("button");
    const openButtonAttr = {
      id: "modalOpen",
      class: "button",
    };
    openButton.innerText = "Open Modal";
    setAttr(openButton, openButtonAttr);
    app.appendChild(openButton);

    // open modal
    openButton.addEventListener("click", function () {
      div.classList.add("overlay");
      div.appendChild(iframe);
    });

    // close event
    window.addEventListener("message", (e) => {
      const message = JSON.parse(e.data).message;
      console.log(message);

      if (message === "CANCEL_MODAL") {
        div.removeChild(iframe);
        div.classList.remove("overlay");
      }
    });

    // html要素に一括で属性を付与する
    function setAttr(elm, obj) {
      for (const i of Object.entries(obj)) {
        elm.setAttribute(i[0], i[1]);
      }
    }
  </script>

  <style>
    .button {
      z-index: 1;
      background: red;
      color: #fff;
      padding: 0 1em;
      margin: 0 1em;
      border: 0;
      width: 120px;
      height: 40px;
      font-size: 16px;
      position: relative;
      border-radius: 10px;
      cursor: pointer;
      align-content: center;
    }
    #my-iframe {
      text-align: center;
      width: 100%;
      height: 100%;
    }
  </style>
</html>
